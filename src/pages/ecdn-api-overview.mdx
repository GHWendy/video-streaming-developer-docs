---
title: ECDN API Overview
description: ECDN API Overview
---

## ECDN API Overview

# API Browser
Easiest way to try/construct queries is: https://beta-portal.deepcaching.com/graphiql (will probably be https://ecdn.video.ibm.com/graphiql at prod). Generated documentation can be found by opening `Docs` in the upper-right corner. It can also be found at https://pages.github.ibm.com/Content-Delivery-Org/ecdn-api/ (but it requires W3 ID).

# Queries

We will use `servers` and `locations` throughout this document, which will return all servers and locations. If you want to query them one-by-one use `serverByID` and `locationByID` instead. i.e:

```graphql
{
	locations {
		id
		name
	}
}
```

will return id and name of all locations, where

```graphql
{
	locationByID(id:12) {
		id
		name
	}
}
```

will return id and name of location with id of `12` only (if it exists).

## Examples

Locations ID, name, external ranges and number of servers.

```graphql
{
	locations {
		id
		name
		numberOfServers
		externalRanges
	}
}
```

Servers ID, FQDN, CPU, memory, system disk size (in bytes), cache disk size (in bytes), IP address, location name, ecdn version with patch level and last check in date.

```graphql
{
	servers {
		id
		fqdn
		lastCheckIn
		location {
			name
		}
		update {
			ecdnVersion
			patchLevel
		}
		hardware {
			cpuCores
			memory
			systemDiskSize
			cacheDiskSize
		}
		desiredConfiguration {
			localIP
		}
	}
}
```

Servers ID, FQDN, detailed health and status of video delivery.
```graphql
{
	servers {
		id
		fqdn
		health {
			contentDelivery {
				aggregated
				upstreams
				caching
			}
			operations {
				aggregated
				updates
				softwareVersion
				apiConnection
				metrics
				ntp
				logForward
				remoteAssistance
				snmp
			}
		}
		videoDelivery {
			numberOfViewers
			numberOfBuffering
		}
	}
}
```


# API

- GraphQL API is at https://beta-graphql.deepcaching.com/v1/graphql (will probalby be at https://api.ecdn.video.ibm.com/v1/graphql at prod).
- Login endpoint is at https://beta-graphql.deepcaching.com/v1/login (will probalby be at https://api.ecdn.video.ibm.com/v1/login at prod).
- Token refresh endpoint is at https://beta-graphql.deepcaching.com/v1/token/refresh (will probalby be at https://api.ecdn.video.ibm.com/v1/token/refresh at prod).

1. Fetch tokens.
```sh
curl 'https://beta-graphql.deepcaching.com/v1/login' -d '{"email":"...","password":"..."}'
# will return:
{
  "accessToken": "YOUR_ACCESS_TOKEN", # JWT token, see https://jwt.io/
  "refreshToken": "YOUR_REFRESH_TOKEN", # this can only be used once.
  "refreshAgeSeconds": 86400 # currently, refresh token expires in one day.
}
```

2. Use API with access token. Note that all if you had a query `{servers{id}}` at API Browser, you must send it as `'{"query":"{servers{id}}"}'` if you use the API directly.
```sh
curl -H 'Authorization: Bearer YOUR_ACCESS_TOKEN' https://beta-graphql.deepcaching.com/v1/graphql -d '{"query":"{servers{id}}"}'
```

3. Refresh tokens. Currently your access token expires in 5 minutes. The actual expiration time can be extracted from JWT's `exp` field. See https://jwt.io/ for further details. Therefore you must use your refresh token to request a new access token before/if it expires.
```sh
curl 'https://beta-graphql.deepcaching.com/v1/token/refresh' -d '{"refreshToken":"YOUR_REFRESH_TOKEN"}'
# will return:
{
  "accessToken": "YOUR_NEW_ACCESS_TOKEN", # JWT token, see https://jwt.io/
  "refreshToken": "YOUR_NEW_REFRESH_TOKEN", # this can only be used once.
  "refreshAgeSeconds": 86400 # currently, refresh token expires in one day.
}
```